# Задание 1 Резервное копирование

Задание 1. Резервное копирование
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

# Ответ:

1.1. Восстановление данных в полном объёме за предыдущий день
В этом случае подходит полное (full) резервное копирование, выполняемое ежедневно (например, ночью, в нерабочее время).

Каждую ночь делается снимок всей базы данных.
Если утром произошёл сбой, можно просто восстановить вчерашнюю копию целиком.
Это просто, надёжно и не требует сложной логики восстановления — берём один бэкап и разворачиваем.
Минус: тратится больше места и времени на бэкап, особенно если база большая.

1.2. Восстановление данных за час до поломки
Здесь уже недостаточно только полного бэкапа — ведь с момента ночного бэкапа прошли часы, и потеряются все операции за это время.

Поэтому используется комбинированный подход:

Полное резервное копирование (раз в сутки, как в п. 1.1),
Плюс инкрементальное или логическое (бинарные логи / binary logs) резервное копирование каждые несколько минут или постоянно.
В MySQL, например, можно включить binary logging (binlog). Тогда:

Делаем полный бэкап ночью.
В течение дня все изменения записываются в binlog.
При сбое в 14:00 мы:
Восстанавливаем полный бэкап (на 00:00),
«Накатываем» binlog-файлы до нужного момента — например, до 13:00.
Такой подход называется point-in-time recovery (PITR) — восстановление на конкретный момент времени.

Важно: для этого нужно, чтобы СУБД поддерживала логирование изменений

# Задание 2 PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

# Ответ:

2.1. Резервное копирование и восстановление

pg_dump — для создания резервной копии,
pg_restore — для восстановления из этой копии (если она в «кастомном» или архивном формате).

Пример: создание резервной копии

```bash
pg_dump -U postgres -h localhost -F c -b -v -f finance_db.backup finance_db

-U postgres — подключаемся от пользователя postgres,
-h localhost — хост (можно опустить, если локально),
-F c — формат custom (бинарный, сжатый, поддерживает выборочное восстановление),
-b — включает большие объекты (например, BLOB),
-v — подробный вывод (verbose),
-f finance_db.backup — имя файла резервной копии,
finance_db — имя базы данных.

Пример: восстановление базы данных

Перед восстановлением нужно создать пустую базу (если её нет):
```bash
createdb -U postgres -h localhost finance_db_restored

А теперь восстанавливаем из бэкапа:
```bash
pg_restore -U postgres -h localhost -d finance_db_restored -v finance_db.backup

Флаги:

-d finance_db_restored — целевая база данных,
-v — подробный режим,
finance_db.backup — наш файл бэкапа.

# Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

# Ответ:

3.1. Инкрементное резервное копирование в MySQL
В MySQL «инкрементное» резервное копирование реализуется не отдельной командой, а с помощью бинарных логов (binary logs, или binlog). Эти логи записывают все изменения данных (INSERT, UPDATE, DELETE и т.д.) в виде событий.

План действий:

1. Сделать полный бэкап (например, через mysqldump).
2. Включить и сохранять бинарные логи — они и есть «инкрементные» изменения.
3. При восстановлении — сначала развернуть полный бэкап, потом «накатить» нужную часть binlog.

Пример: настройка и создание инкрементного бэкапа

1. Убедиться, что binlog включён
В конфигурационном файле MySQL (my.cnf или mysqld.cnf) должно быть:

```bash
[mysqld]
log-bin=mysql-bin
server-id=1

2. Сделать полный бэкап (точка отсчёта)

```bash
mysqldump -u root -p --single-transaction --routines --triggers --master-data=2 finance_db > full_backup.sql

3. Инкрементные изменения — это просто файлы binlog
Новые изменения автоматически пишутся в файлы вроде:

mysql-bin.000001
mysql-bin.000002
и т.д.

```bash
cp /var/lib/mysql/mysql-bin.* /backup/mysql/binlogs/

# Восстановление

1. Восстановить полный бэкап:

```bash
mysql -u root -p finance_db < full_backup.sql

2. Накатить изменения из binlog до нужного момента:
```bash
mysqlbinlog --stop-datetime="2025-10-22 13:00:00" /backup/mysql/binlogs/mysql-bin.000003 | mysql -u root -p


